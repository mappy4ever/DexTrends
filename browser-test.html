<!DOCTYPE html>
<html>
<head>
    <title>DexTrends Browser Testing</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
        iframe { width: 100%; height: 600px; border: 2px solid #333; }
        .console-log { background: #f0f0f0; padding: 10px; margin: 10px 0; max-height: 200px; overflow-y: auto; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>DexTrends Comprehensive Browser Testing</h1>
    <p>Open browser console to see detailed logs</p>
    
    <div id="results"></div>
    
    <script>
        const testPages = [
            { name: 'Homepage', url: 'http://localhost:3002/' },
            { name: 'Pokédex', url: 'http://localhost:3002/pokedex' },
            { name: 'Pikachu (#25)', url: 'http://localhost:3002/pokedex/25', 
              tests: ['Click Evolution tab', 'Click on evolution Pokemon', 'Check abilities'] },
            { name: 'Eevee (#133)', url: 'http://localhost:3002/pokedex/133',
              tests: ['Check multiple evolutions'] },
            { name: 'Favorites', url: 'http://localhost:3002/favorites' },
            { name: 'Pocket Deck Builder', url: 'http://localhost:3002/pocketmode/deckbuilder' }
        ];
        
        const results = document.getElementById('results');
        
        function testPage(pageInfo) {
            const testDiv = document.createElement('div');
            testDiv.className = 'test';
            testDiv.innerHTML = `
                <h3>Testing: ${pageInfo.name}</h3>
                <p>URL: ${pageInfo.url}</p>
                <div class="console-log" id="console-${pageInfo.name.replace(/\s/g, '-')}">
                    <strong>Console Output:</strong><br>
                </div>
                <iframe id="frame-${pageInfo.name.replace(/\s/g, '-')}" src="${pageInfo.url}"></iframe>
            `;
            results.appendChild(testDiv);
            
            const iframe = testDiv.querySelector('iframe');
            const consoleDiv = testDiv.querySelector('.console-log');
            
            iframe.onload = function() {
                try {
                    // Check if we can access the iframe
                    const iframeWindow = iframe.contentWindow;
                    
                    // Override console methods to capture logs
                    const originalLog = iframeWindow.console.log;
                    const originalError = iframeWindow.console.error;
                    const originalWarn = iframeWindow.console.warn;
                    
                    let errorCount = 0;
                    
                    iframeWindow.console.log = function(...args) {
                        originalLog.apply(iframeWindow.console, args);
                        consoleDiv.innerHTML += `LOG: ${args.join(' ')}<br>`;
                    };
                    
                    iframeWindow.console.error = function(...args) {
                        originalError.apply(iframeWindow.console, args);
                        errorCount++;
                        consoleDiv.innerHTML += `<span class="error">ERROR: ${args.join(' ')}</span><br>`;
                        testDiv.classList.add('fail');
                    };
                    
                    iframeWindow.console.warn = function(...args) {
                        originalWarn.apply(iframeWindow.console, args);
                        consoleDiv.innerHTML += `WARN: ${args.join(' ')}<br>`;
                    };
                    
                    // Listen for unhandled errors
                    iframeWindow.addEventListener('error', function(e) {
                        errorCount++;
                        consoleDiv.innerHTML += `<span class="error">UNCAUGHT ERROR: ${e.message} at ${e.filename}:${e.lineno}</span><br>`;
                        testDiv.classList.add('fail');
                    });
                    
                    // If no errors after 3 seconds, mark as pass
                    setTimeout(() => {
                        if (errorCount === 0 && !testDiv.classList.contains('fail')) {
                            testDiv.classList.add('pass');
                            consoleDiv.innerHTML += '<strong>✅ No console errors detected</strong><br>';
                        }
                    }, 3000);
                    
                } catch (e) {
                    consoleDiv.innerHTML += `<span class="error">Cannot access iframe (CORS): ${e.message}</span><br>`;
                }
            };
        }
        
        // Test each page
        testPages.forEach((page, index) => {
            setTimeout(() => testPage(page), index * 4000); // Stagger tests
        });
        
        // Summary after all tests
        setTimeout(() => {
            const failedTests = document.querySelectorAll('.fail').length;
            const passedTests = document.querySelectorAll('.pass').length;
            
            const summary = document.createElement('div');
            summary.style.cssText = 'position: fixed; top: 10px; right: 10px; padding: 20px; background: white; border: 2px solid black;';
            summary.innerHTML = `
                <h2>Test Summary</h2>
                <p>✅ Passed: ${passedTests}</p>
                <p>❌ Failed: ${failedTests}</p>
            `;
            document.body.appendChild(summary);
        }, testPages.length * 4000 + 1000);
    </script>
</body>
</html>